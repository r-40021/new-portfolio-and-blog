---
author: FrogApp
categories: 雑記
tags:
- bot
- ポエム
- 雑記
title: 5人で使っていたbotが学年の半数の人に使われるようになった話(後編)
thumbnail:
  url: "/img/2022/09/24/bot-2.webp"
headAlt: 5人で使っていたbotが学年の半数の人に使われるようになった話　後編：急速な普及と LINE 公式アカウントの裏側
series: 5人で使っていたbotが学年の半数の人に使われるようになった話
series_title: 後編　急速な普及と LINE 公式アカウントの裏側
date: 2022-09-24
slug: bot-2
---

2週間ぶりの投稿になりました。今回は、前回に引き続き「5人で使っていたbotが学年の半数の人に使われるようになった話」の後編をしていきます。

前編を読んでいない方は、前編も読むとこの記事をより楽しめると思いますのでぜひご覧ください。

[5人で使っていたbotが学年の半数の人に使われるようになった話(前編)](/blog/2022-09/bot-1)

さて、「予定通知bot」から生まれた「提出物bot」ですが、その後どのようにして普及していったのでしょうか……

## 口コミの威力

というのも単純で、すべて口コミのおかげです。

同じ大会に出場したメンバーに「拡散よろしく」と言ったら拡散しまくってくれました。

もちろん、自分もクラスLINEで宣伝したり、親しい友人に登録してもらったりしましたが、それでも口コミの力には及びませんでした。

最初は5人で使っていたbotですが、気づけば学年の半数近くの人に使われるようになりました。久しぶりに登録者数の数字を確認したときは目を疑ったレベルです。

普及の流れはこんな感じです。ただ、これだけを記事にすると某コンビニのサンドイッチ並に中身がスカスカになってしまうので、別のことも書いていきます。

## 改良を重ねる

登録者数が増えたことにより、自分の開発意欲も高まってきました。

作ったときには暗号のようだったプログラムも徐々に読めるようになり、細かいところの改善を重ねました。

毎回メッセージを打って送信しなくても良いようにトークルームの画面下部にメニューを入れたり、通知メッセージの末尾に~~オヤジギャグ~~ とても面白いダジャレをランダムに入れるようにしたり、提出物の情報が間違っているときに報告できるフォームを設置したり、botの応答速度を改善したり…

それと同時に、新機能案をもらうこともありました。自分の技量の中でできることは可能な限り取り入れました。多分。

## 嬉しい悲鳴

そんなある日、事件が起こります。

LINEに提出物の一覧が時間になっても来ないのです。一方のDiscord版やTwitter版には通知が行っていました。

なんだろうと思ってログを見てみると…そこには **「メッセージ送信回数が上限に達しました」** という文字が。

![今月のメッセージ送信数が1000通中906通に](/img/2022/09/24/line-limit.webp)

というのも、LINE公式アカウントは無料版だと月に1000通までしかメッセージを送れないという制限があります。

1000通なら余裕だと思うかもしれませんが、メッセージ送信数の計算方法が厄介です。

メッセージ送信数は、**送信相手数×回数**で計算されます。

つまり、100人が登録しているアカウントで登録者全員宛に10回メッセージを送ると100×10＝1000で1000通に達してしまいます。

登録者が増えたことと、学年が上がって提出物の提出日が分散するようになったことが要因です。以前は週明け提出の課題が多かったのですが、最近は「次の授業で提出」という課題が増えました。もちろん、そもそもの提出物の量が増えたこともあります。

このままでは、月末になると機能しない無能botになってしまいます。そこで、ある改革を行うことにしました。

それは、アカウントをクラス別にすることです。

先述の「メッセージは月に1000通まで」という上限はアカウントごとに設定されているので、アカウントを複数に分ければトータルでより多くのメッセージを送れるようになります。

実は、以前からクラスごとに提出日が違う提出物の処理に困っていました。あるクラスだけの提出物の通知が他クラスにも行ってしまい、不便なことがありました。

それもあって、今回クラスごとにアカウントを分けることにしました。アカウントがクラスごとに分かれれば、自分のクラスには無関係の通知が届くことがなくなります。

ちょうど夏休みの時期だったので夏休みを利用してコードを書き、一部の人向けのテストを経た後、正式リリースしました。

この際、複数クラスを登録されてしまうと「メッセージ送信数が上限に達しないようにする」という改革の目的が無意味になってしまうので、複数クラスを登録した場合は最後に登録したクラスにのみ一斉通知が配信されるようにしました。(ちなみに、私は開発者権限で全クラス分の通知が届くようにしています。)これにより、クラス替えの際にも新しいクラスを登録するだけで前のクラスの通知を届かないように出来るので便利です。

この改革では、アカウントをクラス別にする以外にも、bot応答速度の改善やクソコードの書き換えなど様々なことを行いました。

特に応答速度の改善では、使用するAPIを変更したことで最大1秒の高速化に成功しました。

それと同時に、運営を手伝ってくれる方を募集しました。今まで自分一人で運営してきたのですが、いろいろ限界を感じるようになってきたためです。幸い、現時点で4人の方が手を挙げてくれ、自分だけではなかなか知り得ない他クラスの情報を入れてくれたりしていて助かっています。

運営ボランティアに関しては常時募集中ですので、同じ学校かつ同学年の方で興味があれば、チャットルーム内の「報告」ボタンや個チャ等で連絡してください！

## LINE公式アカウントの裏側

話題がガラリと変わりますが、実際にLINE公式アカウントを運営してみて驚いたことを書いていきます。

### ブラウザからチャットが出来る

LINE公式アカウントだと、ブラウザからチャットをすることができます。(応答モードが「チャット」の場合)

通常版LINEもブラウザ版を用意してほしいですね。

ちなみに、画面は普通のLINEのチャットです。相手の名前やアイコン、いつどのようなメッセージを送ってきたか、既読になったかもわかります。

なお提出物botの場合は、応答モードを「Bot」にしているのでこのチャット機能は使えません。

それでも、プログラム側からいつ誰がどんなメッセージを送ってきたかのログを取ることができます。私はそういうログを取ることはしていませんが、運営事業者によってはログを残しているかもしれません。公式アカウントをメモ帳代わりに使う人も居ますが、個人情報やパスワードを送るとどこから漏洩するかわからないのでやめたほうが良いです。

### 様々な分析を見られる

LINE公式アカウントの機能で、様々な分析を見られます。

登録者数の推移やブロックされている人数はもちろん、登録者の性別や居住都道府県の統計も見られます。(あくまでも統計なので、「〇〇さんは××県に住んでいる」のようなことはわかりません。分かるのは「×✕県に住んでいる人が全体の□パーセントいる」までです。)

「LINEに性別や居住都道府県を登録した記憶なんて無いよ！」と思うかもしれませんが、どうやらLINEの使用状況をもとにLINE側が推定しているようです。ちなみに精度はかなり高く、性別に関しては未知数ですが都道府県に関しては百発百中に近いと思います。

話がそれますが、自分がいる市町村はIPアドレスからある程度割り出せます。都道府県ならより高確率で割り出せます。おそらくLINEもIPアドレスや、位置情報の権限を与えているのであればスマホの位置情報から居住都道府県を推定していると思われます。

分析機能を初めて見たときは「これすごい」と思いました。ただ、LINE公式アカウントは店舗が使うことを主に想定しているので、客の特徴を分析できるようにするのは自然なことです。

## 終わりに

先々週から2回に渡って「5人で使っていたbotが学年の半数の人に使われるようになった話」をしてきました。

少しでも楽しんで頂けたのであれば幸いです。
